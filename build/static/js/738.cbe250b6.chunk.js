"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[738],{9332:(e,t,s)=>{s.d(t,{A:()=>l});s(5043);var a=s(3216),r=s(5475),n=s(579);const l=e=>{let{children:t}=e;const s=(0,a.zy)(),l=[{path:"/admin",name:"Dashboard",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})},{path:"/admin/orders",name:"Orders",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})},{path:"/admin/products",name:"Products",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})},{path:"/admin/users",name:"Users",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})},{path:"/admin/sales-dashboard",name:"Sales Dashboard",icon:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 11V7a4 4 0 118 0v4m-1 4h-6m6 0a2 2 0 11-4 0m4 0a2 2 0 11-4 0m-4 0H5m6 0a2 2 0 11-4 0m4 0a2 2 0 11-4 0"})})}];return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100 flex",children:[(0,n.jsxs)("div",{className:"w-64 bg-white shadow-lg",children:[(0,n.jsx)("div",{className:"h-16 bg-green-700 flex items-center px-6",children:(0,n.jsx)("span",{className:"text-white text-lg font-semibold",children:"Admin Panel"})}),(0,n.jsxs)("nav",{className:"mt-6",children:[l.map((e=>(0,n.jsxs)(r.N_,{to:e.path,className:"flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 ".concat(s.pathname===e.path?"bg-gray-100 border-r-4 border-green-700":""),children:[e.icon,(0,n.jsx)("span",{className:"mx-3",children:e.name})]},e.path))),(0,n.jsxs)(r.N_,{to:"/",className:"flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 mt-4",children:[(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),(0,n.jsx)("span",{className:"mx-3",children:"Back to Site"})]})]})]}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"bg-white shadow-sm h-16 flex items-center px-8",children:[(0,n.jsx)("div",{className:"flex-1"}),(0,n.jsx)("div",{className:"flex items-center space-x-4",children:(0,n.jsx)("span",{className:"text-gray-700",children:"Admin"})})]}),(0,n.jsx)("div",{className:"p-8",children:t})]})]})}},738:(e,t,s)=>{s.r(t),s.d(t,{default:()=>o});var a=s(9379),r=s(5043),n=s(465),l=s(475),d=s(2339),i=s(9332),c=s(579);const o=()=>{const[e,t]=(0,r.useState)([]),[s,o]=(0,r.useState)(!0),[m,u]=(0,r.useState)({status:"",dateRange:"all",startDate:"",endDate:"",search:""}),[x,h]=(0,r.useState)({field:"created_at",direction:"desc"}),[p,g]=(0,r.useState)(1),[j,y]=(0,r.useState)(10),[v,f]=(0,r.useState)(null);(0,r.useEffect)((()=>{N()}),[m,x,p,j]);const N=async()=>{try{o(!0);let e=n.N.from("orders").select("\n          *,\n          order_items (\n            quantity,\n            price,\n            products (\n              name,\n              image_url\n            )\n          )\n        ").range((p-1)*j,p*j-1);if(m.status&&(e=e.eq("status",m.status)),"custom"===m.dateRange&&m.startDate&&m.endDate){const t=new Date(m.endDate);t.setDate(t.getDate()+1),e=e.gte("created_at",new Date(m.startDate).toISOString()).lt("created_at",t.toISOString())}else if("all"!==m.dateRange){const t=new Date;let s;switch(m.dateRange){case"today":s=new Date(t.setHours(0,0,0,0));break;case"week":s=new Date(t.setDate(t.getDate()-7));break;case"month":s=new Date(t.setMonth(t.getMonth()-1))}s&&(e=e.gte("created_at",s.toISOString()))}m.search&&(e=e.or("\n          shipping_address.ilike.%".concat(m.search,"%,\n          city.ilike.%").concat(m.search,"%,\n          mobile.ilike.%").concat(m.search,"%,\n          id.ilike.%").concat(m.search,"%\n        "))),e=e.order(x.field,{ascending:"asc"===x.direction});const{data:s,error:r}=await e;if(r)throw console.error("Detailed Error:",r),r;const l=s.map(((e,t)=>(0,a.A)((0,a.A)({},e),{},{serialNo:(p-1)*j+t+1,order_items:e.order_items.map((e=>(0,a.A)((0,a.A)({},e),{},{products:e.products})))})));t(l)}catch(e){console.error("Error fetching orders:",e),d.Ay.error("Failed to load orders")}finally{o(!1)}},b=e=>{h((t=>({field:e,direction:t.field===e&&"asc"===t.direction?"desc":"asc"})))};if(s)return(0,c.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,c.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-700"})})});const w=Math.ceil(e.length/j);return(0,c.jsx)(i.A,{children:(0,c.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Manage Orders"}),(0,c.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"View and manage all customer orders"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,c.jsxs)("span",{className:"px-3 py-1 bg-gray-100 rounded-full",children:["Total Orders: ",e.length]}),(0,c.jsxs)("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full",children:["Pending: ",e.filter((e=>"pending"===e.status)).length]}),(0,c.jsxs)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full",children:["Delivered: ",e.filter((e=>"delivered"===e.status)).length]})]})]}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,c.jsxs)("select",{value:m.status,onChange:e=>u((t=>(0,a.A)((0,a.A)({},t),{},{status:e.target.value}))),className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[(0,c.jsx)("option",{value:"",children:"All Status"}),(0,c.jsx)("option",{value:"pending",children:"Pending"}),(0,c.jsx)("option",{value:"processing",children:"Processing"}),(0,c.jsx)("option",{value:"shipped",children:"Shipped"}),(0,c.jsx)("option",{value:"delivered",children:"Delivered"}),(0,c.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,c.jsxs)("select",{value:m.dateRange,onChange:e=>{u((t=>(0,a.A)((0,a.A)({},t),{},{dateRange:e.target.value,startDate:"custom"===e.target.value?t.startDate:"",endDate:"custom"===e.target.value?t.endDate:""})))},className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",children:[(0,c.jsx)("option",{value:"all",children:"All Time"}),(0,c.jsx)("option",{value:"today",children:"Today"}),(0,c.jsx)("option",{value:"week",children:"Last 7 Days"}),(0,c.jsx)("option",{value:"month",children:"Last 30 Days"}),(0,c.jsx)("option",{value:"custom",children:"Custom Range"})]})]}),"custom"===m.dateRange&&(0,c.jsxs)("div",{className:"md:col-span-2 grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),(0,c.jsx)("input",{type:"date",value:m.startDate,onChange:e=>u((t=>(0,a.A)((0,a.A)({},t),{},{startDate:e.target.value}))),max:m.endDate||void 0,className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),(0,c.jsx)("input",{type:"date",value:m.endDate,onChange:e=>u((t=>(0,a.A)((0,a.A)({},t),{},{endDate:e.target.value}))),min:m.startDate||void 0,max:(new Date).toISOString().split("T")[0],className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,c.jsx)("input",{type:"text",value:m.search,onChange:e=>u((t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value}))),placeholder:"Search orders...",className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rows per page"}),(0,c.jsxs)("select",{value:j,onChange:e=>{y(parseInt(e.target.value,10)),g(1)},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[(0,c.jsx)("option",{value:5,children:"5"}),(0,c.jsx)("option",{value:10,children:"10"}),(0,c.jsx)("option",{value:20,children:"20"}),(0,c.jsx)("option",{value:50,children:"50"})]})]}),(0,c.jsx)("div",{className:"flex items-end",children:(0,c.jsx)("button",{onClick:()=>u({status:"",dateRange:"all",startDate:"",endDate:"",search:""}),className:"bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200",children:"Clear Filters"})})]})}),(0,c.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,c.jsx)("div",{className:"overflow-x-auto",children:(0,c.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,c.jsx)("thead",{className:"bg-gray-50",children:(0,c.jsxs)("tr",{children:[(0,c.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("serialNo"),children:["SL No","serialNo"===x.field&&(0,c.jsx)("span",{className:"ml-1",children:"asc"===x.direction?"\u2191":"\u2193"})]}),(0,c.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("id"),children:["Order ID","id"===x.field&&(0,c.jsx)("span",{className:"ml-1",children:"asc"===x.direction?"\u2191":"\u2193"})]}),(0,c.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("created_at"),children:["Date","created_at"===x.field&&(0,c.jsx)("span",{className:"ml-1",children:"asc"===x.direction?"\u2191":"\u2193"})]}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer Details"}),(0,c.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("total_amount"),children:["Amount","total_amount"===x.field&&(0,c.jsx)("span",{className:"ml-1",children:"asc"===x.direction?"\u2191":"\u2193"})]}),(0,c.jsxs)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("status"),children:["Status","status"===x.field&&(0,c.jsx)("span",{className:"ml-1",children:"asc"===x.direction?"\u2191":"\u2193"})]}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cancellation Reason"}),(0,c.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,c.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map((e=>(0,c.jsxs)(r.Fragment,{children:[(0,c.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{return t=e.id,void f(v===t?null:t);var t},children:[(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.serialNo}),(0,c.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",e.id.slice(0,8)]}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,c.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-500",children:[(0,c.jsx)("p",{children:e.shipping_address}),(0,c.jsxs)("p",{children:[e.city," - ",e.pincode]}),(0,c.jsxs)("p",{children:["Mobile: ",e.mobile]})]}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,l.$)(e.total_amount)}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,c.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full\n                            ".concat("pending"===e.status?"bg-yellow-100 text-yellow-800":"","\n                            ").concat("processing"===e.status?"bg-blue-100 text-blue-800":"","\n                            ").concat("shipped"===e.status?"bg-green-100 text-green-800":"","\n                            ").concat("delivered"===e.status?"bg-green-100 text-green-800":"","\n                            ").concat("cancelled"===e.status?"bg-red-100 text-red-800":"","\n                          "),children:e.status?e.status.charAt(0).toUpperCase()+e.status.slice(1):""})}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.cancel_reason?e.cancel_reason:"N/A"}),(0,c.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,c.jsxs)("select",{className:"text-sm border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500",value:e.status,onChange:t=>async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const{data:a,error:r}=await n.N.from("orders").select("\n          *,\n          order_items (\n            product_id,\n            quantity,\n            products (name)\n          )\n        ").eq("id",e).single();if(r)return console.error("Error fetching order details:",r),void d.Ay.error("Failed to update order status");console.log("Order Details for Stock Management:",{orderId:e,currentStatus:a.status,newStatus:t,orderItems:a.order_items});const l=[];if("cancelled"===t&&["pending","processing"].includes(a.status))for(const e of a.order_items)console.log("Attempting to increment stock for product ".concat(e.product_id,", quantity: ").concat(e.quantity)),l.push(n.N.rpc("increment_product_stock",{product_id:e.product_id,quantity_to_add:e.quantity}).then((t=>{var s;return{productId:e.product_id,productName:(null===(s=e.products)||void 0===s?void 0:s.name)||"Unknown Product",quantity:e.quantity,result:t,error:null}})).catch((t=>{var s;return{productId:e.product_id,productName:(null===(s=e.products)||void 0===s?void 0:s.name)||"Unknown Product",quantity:e.quantity,result:null,error:t}})));if("processing"===t&&"processing"!==a.status)for(const e of a.order_items)console.log("Attempting to decrement stock for product ".concat(e.product_id,", quantity: ").concat(e.quantity)),l.push(n.N.rpc("decrement_product_stock",{product_id:e.product_id,quantity_to_subtract:e.quantity}).then((t=>{var s;return{productId:e.product_id,productName:(null===(s=e.products)||void 0===s?void 0:s.name)||"Unknown Product",quantity:e.quantity,result:t,error:null}})).catch((t=>{var s;return{productId:e.product_id,productName:(null===(s=e.products)||void 0===s?void 0:s.name)||"Unknown Product",quantity:e.quantity,result:null,error:t}})));if(l.length>0){const e=await Promise.all(l);console.log("Stock Adjustment Results:",e);const t=e.filter((e=>e.error));if(t.length>0)return console.error("Stock adjustment errors:",t),void t.forEach((e=>{d.Ay.error("Failed to update stock for ".concat(e.productName))}))}const{error:i}=await n.N.from("orders").update({status:t,cancel_reason:"cancelled"===t?s||"Cancelled by admin":null,cancelled_at:"cancelled"===t?(new Date).toISOString():null}).eq("id",e);if(i)return console.error("Error updating order status:",i),void d.Ay.error("Failed to update order status");await N(),d.Ay.success("Order ".concat(t," successfully"))}catch(a){console.error("Comprehensive order status update error:",a),d.Ay.error("An unexpected error occurred")}}(e.id,t.target.value),children:[(0,c.jsx)("option",{value:"pending",children:"Pending"}),(0,c.jsx)("option",{value:"processing",children:"Processing"}),(0,c.jsx)("option",{value:"shipped",children:"Shipped"}),(0,c.jsx)("option",{value:"delivered",children:"Delivered"}),(0,c.jsx)("option",{value:"cancelled",children:"Cancelled"})]})})]}),v===e.id&&(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:"8",className:"px-6 py-4 bg-gray-50",children:(0,c.jsxs)("div",{className:"rounded-lg",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,c.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Order Items"}),(0,c.jsxs)("span",{className:"text-sm text-gray-500",children:["Total Items: ",e.order_items.length]})]}),(0,c.jsx)("div",{className:"space-y-2",children:e.order_items.map(((e,t)=>(0,c.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg shadow-sm",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-4",children:[e.products.image_url&&(0,c.jsx)("img",{src:e.products.image_url,alt:e.products.name,className:"w-12 h-12 object-cover rounded"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.products.name}),(0,c.jsxs)("p",{className:"text-sm text-gray-500",children:["Quantity: ",e.quantity]})]})]}),(0,c.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(0,l.$)(e.price)})]},t)))}),(0,c.jsx)("div",{className:"mt-3 text-right",children:(0,c.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Subtotal: ",(0,l.$)(e.total_amount)]})})]})})})]},e.id)))})]})})}),(0,c.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,c.jsx)("button",{onClick:()=>g((e=>Math.max(e-1,1))),disabled:1===p,className:"px-4 py-2 bg-gray-200 rounded-md disabled:opacity-50",children:"Previous"}),(0,c.jsxs)("span",{className:"text-sm text-gray-700",children:["Page ",p," of ",w]}),(0,c.jsx)("button",{onClick:()=>g((e=>Math.min(e+1,w))),disabled:p===w,className:"px-4 py-2 bg-gray-200 rounded-md disabled:opacity-50",children:"Next"})]})]})})})}},475:(e,t,s)=>{s.d(t,{$:()=>a});const a=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e)}}]);
//# sourceMappingURL=738.cbe250b6.chunk.js.map