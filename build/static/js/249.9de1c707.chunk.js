"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[249],{6249:(e,r,s)=>{s.r(r),s.d(r,{default:()=>p});var t=s(5043),i=s(5475),a=s(2603),n=s(475),l=s(1439),o=s(9379),c=s(5187),d=s(465),m=s(2339),u=s(3216),x=s(579);const h=e=>{var r,s,i,l;let{isOpen:h,onClose:p}=e;const{user:g}=(0,c.A)(),{cart:b,getCartTotal:y,clearCart:j}=(0,a._)(),[f,v]=(0,t.useState)(!1),[N,w]=(0,t.useState)(!1),[k,C]=(0,t.useState)(null),A=(0,u.Zp)(),[S,q]=(0,t.useState)({address:(null===g||void 0===g||null===(r=g.user_metadata)||void 0===r?void 0:r.address)||"",city:(null===g||void 0===g||null===(s=g.user_metadata)||void 0===s?void 0:s.city)||"",pincode:(null===g||void 0===g||null===(i=g.user_metadata)||void 0===i?void 0:i.pincode)||"",mobile:(null===g||void 0===g||null===(l=g.user_metadata)||void 0===l?void 0:l.mobile)||""}),_=e=>{q((0,o.A)((0,o.A)({},S),{},{[e.target.name]:e.target.value}))};return h?N&&k?(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:[(0,x.jsxs)("div",{className:"text-center mb-6",children:[(0,x.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,x.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,x.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Placed Successfully!"}),(0,x.jsxs)("p",{className:"text-gray-600",children:["Order ID: #",k.orderId]})]}),(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h3",{className:"font-semibold mb-2",children:"Order Summary"}),(0,x.jsxs)("div",{className:"space-y-2",children:[k.items.map((e=>(0,x.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,x.jsxs)("span",{children:[e.name," \xd7 ",e.quantity]}),(0,x.jsx)("span",{children:(0,n.$)(e.price*e.quantity)})]},e.id))),(0,x.jsx)("div",{className:"border-t pt-2 font-bold",children:(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:"Total:"}),(0,x.jsx)("span",{children:(0,n.$)(k.total)})]})})]})]}),(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h3",{className:"font-semibold mb-2",children:"Shipping Details"}),(0,x.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,x.jsx)("p",{children:k.shipping.address}),(0,x.jsxs)("p",{children:[k.shipping.city," - ",k.shipping.pincode]}),(0,x.jsxs)("p",{children:["Mobile: ",k.shipping.mobile]})]})]}),(0,x.jsxs)("div",{className:"space-y-3",children:[(0,x.jsx)("button",{onClick:()=>A("/products"),className:"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition duration-300",children:"Continue Shopping"}),(0,x.jsx)("button",{onClick:p,className:"w-full border border-gray-300 text-gray-700 py-2 rounded hover:bg-gray-50 transition duration-300",children:"Close"})]})]})}):(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,x.jsx)("h2",{className:"text-2xl font-bold",children:"Checkout"}),(0,x.jsx)("button",{onClick:p,className:"text-gray-500 hover:text-gray-700",children:(0,x.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h3",{className:"font-semibold mb-2",children:"Order Summary"}),(0,x.jsxs)("div",{className:"space-y-2",children:[b.map((e=>(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsxs)("span",{children:[e.name," \xd7 ",e.quantity]}),(0,x.jsx)("span",{children:(0,n.$)(e.price*e.quantity)})]},e.id))),(0,x.jsx)("div",{className:"border-t pt-2 font-bold",children:(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:"Total:"}),(0,x.jsx)("span",{children:(0,n.$)(y())})]})})]})]}),(0,x.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),S.address.trim()?S.city.trim()?/^\d{6}$/.test(S.pincode)?/^[0-9]{10}$/.test(S.mobile)||(m.Ay.error("Please enter a valid 10-digit mobile number"),0):(m.Ay.error("Please enter a valid 6-digit pincode"),0):(m.Ay.error("Please enter your city"),0):(m.Ay.error("Please enter your shipping address"),0))if(0!==b.length){v(!0);try{const e=await Promise.all(b.map((async e=>{const{data:r,error:s}=await d.N.from("products").select("id, name, stock, price").eq("id",e.id).single();return console.log("Product Fetch Result:",{productId:e.id,product:r,requestedQuantity:e.quantity,productError:s}),s?(console.error("Error fetching product ".concat(e.id,":"),s),m.Ay.error("Error checking product ".concat(e.name)),{valid:!1,item:e,error:s}):r?r.stock<e.quantity?(m.Ay.error("Insufficient stock for ".concat(r.name,". Only ").concat(r.stock," available.")),{valid:!1,item:e,error:"Insufficient stock. Only ".concat(r.stock," available.")}):{valid:!0,item:e,product:r}:(m.Ay.error("Product ".concat(e.name," not found")),{valid:!1,item:e,error:"Product not found"})})));if(e.filter((e=>!e.valid)).length>0)return void v(!1);const{data:r,error:s}=await d.N.from("orders").insert({user_id:g.id,total_amount:y(),shipping_address:S.address,city:S.city,pincode:S.pincode,mobile:S.mobile,status:"processing"}).select().single();if(s)return console.error("Order creation error:",s),m.Ay.error("Failed to create order"),void v(!1);const t=b.map((e=>({order_id:r.id,product_id:e.id,quantity:e.quantity,price:e.price}))),i=(await Promise.all(b.map((async e=>{console.log("Attempting to decrement stock for product ".concat(e.id,", quantity: ").concat(e.quantity));const{data:r,error:s}=await d.N.rpc("decrement_product_stock",{product_id:e.id,quantity_to_subtract:e.quantity});return console.log("Stock Update Result:",{productId:e.id,productName:e.name,stockUpdateSuccessful:!0===r,error:s}),{productId:e.id,productName:e.name,stockUpdateSuccessful:!0===r,error:s}})))).filter((e=>!e.stockUpdateSuccessful));if(i.length>0){await d.N.from("orders").delete().eq("id",r.id);const e=i.map((e=>e.productName)).join(", ");return console.error("Stock Update Failures:",i),m.Ay.error("Stock update failed for: ".concat(e)),void v(!1)}const{error:a}=await d.N.from("order_items").insert(t);if(a)return console.error("Order items creation error:",a),m.Ay.error("Failed to create order items"),void v(!1);j(),p(),m.Ay.success("Order placed successfully!")}catch(r){console.error("Comprehensive checkout error:",r),m.Ay.error("An unexpected error occurred during checkout")}finally{v(!1)}}else m.Ay.error("Your cart is empty")},className:"space-y-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Mobile Number"}),(0,x.jsx)("input",{type:"tel",name:"mobile",value:S.mobile,onChange:_,className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500",pattern:"[0-9]{10}",placeholder:"Enter 10-digit mobile number",required:!0})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Shipping Address"}),(0,x.jsx)("textarea",{name:"address",value:S.address,onChange:_,className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500",rows:"3",required:!0})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"City"}),(0,x.jsx)("input",{type:"text",name:"city",value:S.city,onChange:_,className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500",required:!0})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Pincode"}),(0,x.jsx)("input",{type:"text",name:"pincode",value:S.pincode,onChange:_,className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500",pattern:"[0-9]{6}",required:!0})]}),(0,x.jsx)("button",{type:"submit",className:"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition duration-300 disabled:opacity-50",disabled:f,children:f?(0,x.jsxs)("span",{className:"flex items-center justify-center",children:[(0,x.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,x.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,x.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Place Order (".concat((0,n.$)(y()),")")})]})]})}):null},p=()=>{const{cart:e,removeFromCart:r,updateQuantity:s,getCartTotal:o}=(0,a._)(),[d,u]=(0,t.useState)(!1),{user:p}=(0,c.A)();return 0===e.length?(0,x.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,x.jsx)(l.A,{}),(0,x.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-16",children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Your Cart is Empty"}),(0,x.jsx)("p",{className:"text-gray-600 mb-8",children:"Add some spices to your cart and come back!"}),(0,x.jsx)(i.N_,{to:"/products",className:"inline-block bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-300",children:"Continue Shopping"})]})})]}):(0,x.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,x.jsx)(l.A,{}),(0,x.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-16",children:[(0,x.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Shopping Cart"}),(0,x.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,x.jsx)("div",{className:"md:col-span-2",children:(0,x.jsx)("div",{className:"bg-white rounded-lg shadow-md",children:e.map((e=>(0,x.jsxs)("div",{className:"flex items-center p-6 border-b border-gray-200 last:border-b-0",children:[(0,x.jsx)("img",{src:e.image_url,alt:e.name,className:"w-24 h-24 object-cover rounded"}),(0,x.jsxs)("div",{className:"flex-1 ml-6",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold",children:e.name}),(0,x.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.origin}),(0,x.jsx)("div",{className:"flex items-center",children:(0,x.jsx)("span",{className:"text-green-600 font-bold",children:(0,n.$)(e.price)})})]}),(0,x.jsxs)("div",{className:"flex items-center ml-6",children:[(0,x.jsxs)("div",{className:"flex items-center border border-gray-300 rounded",children:[(0,x.jsx)("button",{onClick:()=>s(e.id,e.quantity-1),className:"px-3 py-1 hover:bg-gray-100",disabled:e.quantity<=1,children:"-"}),(0,x.jsx)("span",{className:"px-3 py-1 border-x border-gray-300",children:e.quantity}),(0,x.jsx)("button",{onClick:()=>s(e.id,e.quantity+1),className:"px-3 py-1 hover:bg-gray-100",children:"+"})]}),(0,x.jsx)("button",{onClick:()=>r(e.id),className:"ml-4 text-red-500 hover:text-red-700",children:(0,x.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,x.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id)))})}),(0,x.jsx)("div",{className:"md:col-span-1",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Order Summary"}),(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,x.jsx)("p",{children:"Subtotal"}),(0,x.jsx)("p",{children:(0,n.$)(o())})]}),(0,x.jsxs)("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[(0,x.jsx)("p",{children:"Shipping"}),(0,x.jsx)("p",{children:"Free"})]}),(0,x.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,x.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,x.jsx)("p",{children:"Total"}),(0,x.jsx)("p",{children:(0,n.$)(o())})]})}),(0,x.jsx)("button",{className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-300",onClick:()=>{p?u(!0):m.Ay.error("Please login to checkout")},children:"Proceed to Checkout"}),(0,x.jsx)(i.N_,{to:"/products",className:"block text-center text-green-600 hover:text-green-700",children:"Continue Shopping"})]})]})})]})]}),(0,x.jsx)(h,{isOpen:d,onClose:()=>u(!1)})]})}},475:(e,r,s)=>{s.d(r,{$:()=>t});const t=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e)}}]);
//# sourceMappingURL=249.9de1c707.chunk.js.map